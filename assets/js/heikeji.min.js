/*!
 * bilibili_hkj v0.2.8 (http://keyfunc.github.io/bilibili_hkj)
 * Copyright 2012-2014 Key Dai
 * Licensed under MIT (http://github.com/keyfunc/bilibili_hkj/blob/master/LICENSE)
 */
(function(){var a=[].slice;!function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(this._c_tip=function(){var c,d,e,f,g,h,i;for(d=arguments[0],f=2<=arguments.length?a.call(arguments,1):[],c=b.createElement("div"),c.className="tip",g=0,h=f.length;h>g;g++)e=f[g],i=b.createElement("p"),i.innerHTML=e,c.appendChild(i);return d.appendChild(c),__hidden(c,5e3)},this._c_message=function(){var c,d,e,f,g,h,i,j,k,l,m;for(d=arguments[0],g=arguments[1],h=arguments[2],f=4<=arguments.length?a.call(arguments,3):[],c=b.createElement("div"),c.className="message",j=b.createElement("h4"),i=b.createElement("a"),i.innerHTML=g,i.href=h,i.target="_blank",j.appendChild(i),c.appendChild(j),k=0,l=f.length;l>k;k++)e=f[k],m=b.createElement("p"),m.innerHTML=e,c.appendChild(m);return d.appendChild(c),__hidden(c,2e4)},this.__hidden=function(a,b){return setTimeout(function(){var b,d;return b=1,d=setInterval(function(){return b-=.01,a.style.opacity=b,0>b?(c.clearInterval(d),a.parentNode.removeChild(a)):void 0},20)},b)},v=/http:\/\/(www\.bilibili\.com|www\.bilibili\.tv|bilibili\.kankanews\.com)?\/video\/av([0-9]+)\/(?:index_([0-9]+)\.html)?/.exec(b.URL),r=/http:\/\/(www\.bilibili\.com|www\.bilibili\.tv|bilibili\.kankanews\.com)/.exec(b.URL),n=!v&&!!r,s=r?r[0]:null,g=b.getElementsByTagName("head")[0],m=b.createElement("style"),m.type="text/css",m.appendChild(b.createTextNode('#_callouts {\n  position: fixed;\n  right: 16px;\n  bottom: 32px;\n  z-index: 999;\n}\n#_callouts div {\n  position: relative;\n  margin: 10px 0;\n  padding: 7px 15px 7px 12px;\n  text-align:left;\n  border-left:5px solid #eee;\n  font: 13px/1.65 "Segoe UI", "Helvetica Neue", Helvetica, Arial, "Hiragino Kaku Gothic Pro", "Meiryo", "Hiragino Sans GB", "Microsoft YaHei", "STHeiti", "SimSun", Sans-serif;\n  z-index: 999;\n}\n#_callouts div p,\n#_callouts div h4 {\n  margin: 0;\n}\n#_callouts div.message {\n  background-color: #fdf7f7;\n  border-color: #d9534f;\n}\n#_callouts div.message h4,\n#_callouts div.message h4 * {\n  color: #d9534f;\n  text-decoration: none;\n}\n#_callouts div.tip {\n  background-color: #f4f8fa;\n  border-color: #5bc0de;\n}')),g.appendChild(m),e=b.createElement("div"),e.id="_callouts",b.body.appendChild(e),!v&&!n)return void(c.bilibili_hkj=function(){return _c_tip(e,"痴萝莉, 爱腐女","控锁骨, 恋百合")})();if(k=new Date("2014/10/6").getTime()+1296e6,(new Date).getTime()-k<0&&_c_message(e,"修复新版bilibili下2P模式失效问题","http://keyfunc.github.io/bilibili_hkj/","重构部分代码，增加异常处理"),i="1.11.1",this.Loader={importJS:function(a,c,d){var e;return e=b.createElement("script"),e.type="text/javascript",e.onload=function(){return console.log("onLoad: "+a),void 0!==d?d():void 0},e.src=a,c.appendChild(e)},importCSS:function(a,c,d){var e;return e=b.createElement("link"),e.type="text/css",e.rel="stylesheet",e.onload=function(){return console.log("onLoad: "+a),void 0!==d?d():void 0},e.href=a,c.appendChild(e)}},j=!0,void 0!==c.jQuery)for(p=i.split("."),f=$.fn.jquery.split("."),h=t=0,u=f.length;u>t;h=++t){if(o=f[h],o=parseInt(o),w=parseInt(p[h]),w>o){q=jQuery.noConflict(),console.log("jQuery version: "+q.fn.jquery+" --> "+i),j=!0;break}if(o>w){j=!1;break}j=!1}return l=function(a){var d,f,h;d="http://api.bilibili.com/view?type=json&appkey=12737ff7776f1ade&id="+a[2]+(void 0!==a[3]?"&page="+a[3]:""),h="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url=%22"+encodeURIComponent(d)+"%22&format=json&callback=cbfunc",$("#bofqi").empty(),$("#bofqi").append("<div id='player_placeholder' class='player'></div>"),_c_tip(e,"成功干掉原先的播放器"),f=b.createElement("script"),f.setAttribute("src",h),f.onload=function(){return this.parentNode.removeChild(this),f=null},g.appendChild(f),(c.bilibili_hkj=function(){return _c_tip(e,"正在获取神秘代码")})()},d=function(){return n?($("a[href*='/video/av']").click(function(a){var b,d;return a.preventDefault(),v=/(\/video|video)\/av([0-9]+)?/.exec($(this).attr("href")),d=$(this).text(),$(".z").remove(),b=$('<div class="z"></div>'),$(".header").after(b),b.load(s+"/video/av877489/ .z:first",function(){var a;try{$(".cover_image",b).hide(),$(".tminfo span[typeof='v:Breadcrumb']",b).remove(),$(".tminfo time",b).remove(),$(".info .fav_btn_top",b).attr("onclick",$(".info .fav_btn_top",b).attr("onclick").replace("877489",v[2])),$(".arc-tool-bar .fav a",b).attr("href",$(".arc-tool-bar .fav a",b).attr("href").replace("877489",v[2])),$(".arc-tool-bar .fav a",b).attr("onclick",$(".arc-tool-bar .fav a",b).attr("onclick").replace("877489",v[2])),$(".ad-f",b).remove(),$(".ad-e1",b).remove(),$(".ad-e2",b).remove(),$(".info h2",b).text("").attr("title",""),$(".intro",b).text(""),$(".common .comm img",b).attr("onclick",$(".common .comm img",b).attr("onclick").replace("877489",v[2])),$("#newtag a",b).attr("onclick",$("#newtag a",b).attr("onclick").replace("877489",v[2])),$("#rate_frm",b).attr("aid",v[2])}catch(e){a=e,console.log(a)}return void 0!==c.history.pushState&&c.history.pushState(null,d,s+"/video/av"+v[2]),Loader.importJS("http://static.hdslb.com/js/page.arc.js",g),Loader.importJS("http://static.hdslb.com/js/jquery.qrcode.min.js",g),Loader.importJS("http://interface.bilibili.cn/count?aid="+v[2],g),Loader.importJS("http://static.hdslb.com/js/swfobject.js",g),Loader.importJS("http://static.hdslb.com/js/video.min.js",g),Loader.importCSS("http://static.hdslb.com/css/bpoint/bpoints.css",g),Loader.importJS("http://static.hdslb.com/js/bpoint/bpoints.js",g),l(v)})}),$(c).on("popstate",function(){return c.location.replace(b.location)}),(c.bilibili_hkj=function(){return _c_tip(e,"2P模式初始化完成","＼(・ω・＼)丧尸！(／・ω・)／bishi")})(),void 0):b.getElementById("player_placeholder")||b.getElementById("bofqi_embed")||function(){var a,c,d;c=b.getElementsByTagName("iframe"),a=/https:\/\/secure\.bilibili\.com\/secure,cid=([0-9]+)(?:&aid=([0-9]+))?/;for(d in c)if(a.exec(c[d].src))return!0;return!1}()?void(c.bilibili_hkj=function(){return _c_tip(e,"bilibili满状态中","＼(・ω・＼)丧尸！(／・ω・)／bishi")})():l(v)},this.cbfunc=function(){var a;return a=arguments[0].query.results.json,void 0!==a.cid?(_c_tip(e,"获取神秘代码成功","神秘代码ID: "+a.cid),n&&($(".info h2").text(a.title).attr("title",a.title),$(".intro").text(a.description),this.mid=a.mid,kwtags(a.tag.split(","),""),$("title").text(a.title)),EmbedPlayer("player","http://static.hdslb.com/play.swf","cid="+a.cid+"&aid="+v[2]),(c.bilibili_hkj=function(){return _c_tip(e,"Mission Completed","嗶哩嗶哩 - ( ゜- ゜)つロ  乾杯~")})()):(_c_tip(e,"非常抱歉, bishi姥爷不肯给神秘代码",'要不你吼一声"兵库北"后再试试?'),c.bilibili_hkj=null)},j?Loader.importJS("http://keyfunc.github.io/bilibili_hkj/assets/js/jquery-"+i+".min.js",g,d):d()}(document,window)}).call(this);
//# sourceMappingURL=heikeji.min.js.map